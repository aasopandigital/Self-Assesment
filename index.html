<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ujian Bahasa Inggris</title>

<style>
body { font-family: Arial; max-width: 800px; margin: auto; padding: 20px; }
.hidden { display:none; }
#timer { color:red; font-weight:bold; margin-bottom:15px; }
.question { margin-bottom:20px; }
.passage {
  background:#f4f4f4;
  padding:15px;
  margin:20px 0;
  border-left:4px solid #444;
}
button { padding:10px 20px; font-size:16px; cursor:pointer; }
</style>
</head>

<body>

<h2>Ujian Bahasa Inggris</h2>

<!-- LOGIN -->
<div id="login">
  <p>Masukkan nama sebelum mulai:</p>
  <input type="text" id="nama">
  <br><br>
  <button type="button" onclick="start()">MULAI UJIAN</button>
</div>

<!-- QUIZ -->
<div id="quiz" class="hidden">
  <div id="timer"></div>
  <div id="questions"></div>
</div>

<script>
let waktu = 3600;
let timerInterval;

/* ================= START ================= */
function start() {
  if (!document.getElementById("nama").value.trim()) {
    alert("Masukkan nama terlebih dahulu!");
    return;
  }

  localStorage.setItem("examStarted","yes");

  document.getElementById("login").style.display="none";
  document.getElementById("quiz").classList.remove("hidden");

  renderQuestions();
  startTimer();
}

/* ================= TIMER ================= */
function startTimer() {
  timerInterval = setInterval(() => {
    let m = Math.floor(waktu/60);
    let s = waktu%60;
    document.getElementById("timer").innerText =
      `Sisa waktu: ${m}:${s<10?"0":""}${s}`;
    waktu--;
    if (waktu < 0) selesai();
  },1000);
}

/* ================= TEXT & SOAL ================= */
const passages = [
  {
    text: `
    <b>Text 1</b><br>
    Learning styles differ from one student to another. Some students learn best
    through visual materials, while others prefer auditory explanations. 
    Understanding one’s own learning preference allows students to study more 
    effectively and avoid unnecessary frustration. Without this awareness, 
    learners often waste time using ineffective strategies.
    `,
    questions: [
      { q:"The paragraph mainly discusses…", options:["teaching methods","learning styles","school rules","student age","exam systems"], answer:1 },
      { q:"Students learn better when they…", options:["copy others","study longer","understand themselves","avoid planning","use one method"], answer:2 },
      { q:"Ineffective strategies may cause…", options:["success","motivation","wasted time","discipline","confidence"], answer:2 },
      { q:"The tone of the text is…", options:["critical","informative","emotional","negative","sarcastic"], answer:1 }
    ]
  },

  {
    text: `
    <b>Text 2</b><br>
    Technology has transformed education by making information more accessible.
    However, excessive dependence on digital tools may reduce students’ critical
    thinking skills. When learners rely too much on applications, they often stop
    questioning information and accept answers without evaluation.
    `,
    questions: [
      { q:"The paragraph suggests that technology…", options:["is harmful","should be avoided","must be used wisely","replaces teachers","limits learning"], answer:2 },
      { q:"Critical thinking decreases when students…", options:["analyze deeply","read books","depend excessively","discuss ideas","reflect"], answer:2 },
      { q:"The word <i>excessive</i> is closest in meaning to…", options:["limited","balanced","too much","careful","minimal"], answer:2 },
      { q:"The writer’s attitude toward technology is…", options:["fully positive","fully negative","balanced","unclear","emotional"], answer:2 }
    ]
  },

  {
    text: `
    <b>Text 3</b><br>
    Failure is often viewed negatively, yet it plays an essential role in learning.
    Through failure, individuals recognize weaknesses and improve strategies.
    Students who reflect on mistakes tend to develop resilience and deeper
    understanding compared to those who avoid challenges.
    `,
    questions: [
      { q:"Failure is described as…", options:["harmful","useless","a learning tool","a weakness","an ending"], answer:2 },
      { q:"Students benefit from failure when they…", options:["ignore it","reflect","blame others","give up","avoid risks"], answer:1 },
      { q:"The paragraph implies that reflection leads to…", options:["fear","resilience","confusion","delay","stress"], answer:1 },
      { q:"The tone of the text is…", options:["fearful","constructive","angry","hopeless","neutral"], answer:1 }
    ]
  },

  {
    text: `
    <b>Text 4</b><br>
    Environmental damage caused by human activities often results in irreversible
    consequences. Raising public awareness through education and responsible
    policies is essential to ensure sustainable development for future generations.
    `,
    questions: [
      { q:"Irreversible means…", options:["temporary","avoidable","permanent","harmless","natural"], answer:2 },
      { q:"The best solution suggested is…", options:["ignoring issues","waiting","public awareness","technology alone","doing nothing"], answer:2 },
      { q:"The paragraph emphasizes the importance of…", options:["industry","education","punishment","economy","delay"], answer:1 },
      { q:"The main theme is…", options:["pollution","technology","sustainability","competition","tradition"], answer:2 }
    ]
  }
];

/* ================= RENDER ================= */
function renderQuestions() {
  const container = document.getElementById("questions");
  let html = "";

  passages.forEach((p,pi)=>{
    html += `<div class="passage">${p.text}</div>`;
    p.questions.forEach((q,qi)=>{
      const index = pi*4 + qi;
      html += `<div class="question"><p>${index+1}. ${q.q}</p>`;
      q.options.forEach((o,j)=>{
        html += `<label><input type="radio" name="q${index}" value="${j}"> ${o}</label><br>`;
      });
      html += `</div>`;
    });
  });

  html += `<button type="button" onclick="selesai()">SELESAI UJIAN</button>`;
  container.innerHTML = html;
}

/* ================= SELESAI ================= */
function selesai() {
  clearInterval(timerInterval);
  localStorage.removeItem("examStarted");

  let score = 0;
  let index = 0;
  passages.forEach(p=>{
    p.questions.forEach(q=>{
      const c = document.querySelector(`input[name="q${index}"]:checked`);
      if (c && +c.value === q.answer) score++;
      index++;
    });
  });

  const fd = new FormData();
  fd.append("nama", document.getElementById("nama").value);
  fd.append("skor", score);
  fd.append("total", index);

  fetch("https://script.google.com/macros/s/AKfycbxEFXvRa3q4qfPyU_q5LnHXtYlH7w3slGKMukQ8DV9RtRxiPY8gIkIJrVtrRdOUQm36TQ/exec", {
    method:"POST",
    body:fd
  })
  .then(()=>alert("Ujian selesai\nNilai: "+score))
  .then(()=>location.reload())
  .catch(()=>alert("Gagal mengirim nilai"));
}

/* ================= RESUME ================= */
if (localStorage.getItem("examStarted")==="yes") {
  document.getElementById("login").style.display="none";
  document.getElementById("quiz").classList.remove("hidden");
  renderQuestions();
  startTimer();
}
</script>

</body>
</html>
