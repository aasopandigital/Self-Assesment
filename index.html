<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ulangan Online Bahasa Inggris SMA X</title>
<style>
body{font-family:Arial;background:#f4f6f8}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:8px}
.hidden{display:none}
.question{margin-bottom:20px}
button{padding:10px 20px;font-size:16px;cursor:pointer}
#timer{font-weight:bold;color:#c0392b;margin-bottom:15px}
</style>
</head>
<body>
<div class="container">
<h2>ULANGAN ONLINE – Bahasa Inggris (SMA X)</h2>

<div id="login">
<p>Nama:</p>
<input id="nama" style="width:100%">
<p>Password:</p>
<input id="pw" type="password" style="width:100%">
<br><br>
<button onclick="start()">Mulai</button>
</div>

<form id="quiz" class="hidden">
<div id="timer">Sisa waktu: 60:00</div>
<div id="questions"></div>
<button type="button" onclick="submitQuiz()">Kirim Jawaban</button>
</form>

<div id="result"></div>
</div>

<script>
// ================= CONFIG =================
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw-XEokgUPZu62S98yaiYWe8gSb4LrQV-b-itqwSIQ11EZOAydYUAHqumvwE_H3icU7/exec";
let waktu = 60 * 60; // 60 menit
let timerInterval;
let selectedQuestions = [];

// ================= BANK SOAL =================
const questionBank = [
{
text:`One afternoon, Raka decided to explore a forest near his village.
He had often heard stories about the forest, but he never visited it alone before.

As he walked deeper, the air became cooler and the trees grew taller.
Raka felt both excited and nervous as unfamiliar sounds surrounded him.

Suddenly, he realized that he had lost his way.
The path he followed was no longer visible, and panic started to rise.

After calming himself, Raka remembered his grandfather’s advice.
He observed the position of the sun and finally found his way home safely.`,
questions:[
{q:"What is the main idea of the story?",opts:["Raka followed his friends","Raka explored a forest alone","Raka camped in the forest","Raka hunted animals","Raka visited his grandfather"],a:1},
{q:"Why did Raka feel nervous?",opts:["He met wild animals","He was tired","He heard unfamiliar sounds","It was raining","He was hungry"],a:2},
{q:"How did Raka solve his problem?",opts:["He called his friend","He shouted for help","He followed the river","He observed nature","He waited"],a:3},
{q:"What can be learned from the story?",opts:["Courage is useless","Nature is dangerous","Listening to advice is important","Forests should be avoided","Walking alone is fun"],a:2}
]
},
{
text:`Last holiday, my family and I went to a small beach in the south of the city.
We left early in the morning to avoid traffic.

When we arrived, the weather was sunny and the sea looked calm.
My siblings and I played with the sand while our parents prepared food.

After lunch, we swam together and collected seashells.
Time passed quickly without us realizing it.

In the afternoon, we returned home feeling tired but happy.
It was a simple trip, yet it became a memorable experience.`,
questions:[
{q:"What is the text mainly about?",opts:["A school activity","A family trip","A camping event","A fishing competition","A beach cleanup"],a:1},
{q:"Why did they leave early?",opts:["To swim longer","To avoid traffic","To meet friends","To see sunrise","To find shells"],a:1},
{q:"What did the writer feel at the end?",opts:["Angry","Bored","Disappointed","Happy","Sleepy"],a:3},
{q:"The word memorable means…",opts:["Easy to forget","Hard to do","Worth remembering","Very expensive","Dangerous"],a:2}
]
},
{
text:`My school library is one of my favorite places.
It is located on the second floor of the main building.

The room is wide and filled with wooden bookshelves.
Various books are arranged neatly, from novels to reference books.

Large windows allow sunlight to brighten the room.
There are also comfortable chairs where students can read quietly.

Because of its calm atmosphere, many students come to study here.
The library helps us focus better on our learning.`,
questions:[
{q:"What is being described?",opts:["A classroom","A library","A bookstore","A laboratory","An office"],a:1},
{q:"Where is the library located?",opts:["Near the gate","Behind the school","On the second floor","Beside the canteen","In the yard"],a:2},
{q:"Why do students like the library?",opts:["It is noisy","It sells books","It has games","It is calm","It is crowded"],a:3},
{q:"The word atmosphere is closest in meaning to…",opts:["Temperature","Air","Situation","Building","Furniture"],a:2}
]
},
{
text:`Making a cup of tea is very easy.
First, prepare a cup, tea bag, sugar, and hot water.

Next, put the tea bag into the cup.
Then, pour hot water into the cup carefully.

After that, add sugar according to your taste.
Stir the tea until the sugar dissolves completely.

Finally, remove the tea bag and enjoy your tea.
You can drink it while it is still warm.`,
questions:[
{q:"What is the purpose of the text?",opts:["To describe tea","To tell a story","To explain how to make tea","To compare drinks","To advertise tea"],a:2},
{q:"What should be done after pouring hot water?",opts:["Remove the tea bag","Add sugar","Drink the tea","Boil water","Prepare cup"],a:1},
{q:"Why should the tea be stirred?",opts:["To cool it","To dissolve sugar","To change color","To remove bag","To smell it"],a:1},
{q:"The word dissolve means…",opts:["Disappear in liquid","Be frozen","Become solid","Be thrown away","Be mixed badly"],a:0}
]
}
];

// ================= START =================
function start(){
  if(document.getElementById("nama").value.trim()===""){
    alert("Nama wajib diisi");return;
  }
  document.getElementById("login").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  shuffle(questionBank);
  questionBank.forEach(t=>shuffle(t.questions));
  selectedQuestions=[];
  questionBank.forEach(t=>selectedQuestions.push(...t.questions));
  selectedQuestions=selectedQuestions.slice(0,30);
  renderQuestions();
  startTimer();
}

// ================= TIMER =================
function startTimer(){
  timerInterval=setInterval(()=>{
    let m=Math.floor(waktu/60),s=waktu%60;
    document.getElementById("timer").innerText="Sisa waktu: "+m+":"+(s<10?"0":"")+s;
    waktu--;if(waktu<0){clearInterval(timerInterval);submitQuiz();}
  },1000);
}

// ================= RENDER =================
function renderQuestions(){
  let html="";
  selectedQuestions.forEach((q,i)=>{
    html+=`<div class=\"question\"><b>${i+1}. ${q.q}</b><br>`;
    let opts=[...q.opts];shuffle(opts);
    opts.forEach(o=>{
      let val=(o===q.opts[q.a])?1:0;
      html+=`<input type=\"radio\" name=\"q${i}\" value=\"${val}\"> ${o}<br>`;
    });
    html+="</div>";
  });
  document.getElementById("questions").innerHTML=html;
}

// ================= SUBMIT =================
function submitQuiz(){
  clearInterval(timerInterval);
  let score=0;
  selectedQuestions.forEach((_,i)=>{
    let q=document.querySelector(`input[name=\"q${i}\"]:checked`);
    if(q)score+=parseInt(q.value);
  });
  let nilai=Math.round(score/selectedQuestions.length*100);
  fetch(WEB_APP_URL,{method:"POST",body:JSON.stringify({nama:document.getElementById("nama").value,nilai:nilai})});
  document.getElementById("result").innerHTML="<h3>Nilai: "+nilai+"</h3>";
}

// ================= UTIL =================
function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
</script>
</body>
</html>
