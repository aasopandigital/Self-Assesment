<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ujian Bahasa Inggris</title>

<style>
body { font-family: Arial; max-width: 800px; margin: auto; padding: 20px; }
.hidden { display:none; }
#timer { color:red; font-weight:bold; margin-bottom:15px; }
.question { margin-bottom:20px; }
button { padding:10px 20px; font-size:16px; }
</style>
</head>

<body>

<h2>Ujian Bahasa Inggris</h2>

<div id="login">
  <p>Masukkan nama sebelum mulai:</p>
  <input type="text" id="nama">
  <br><br>
  <button onclick="start()">MULAI UJIAN</button>
</div>

<div id="quiz" class="hidden">
  <div id="timer"></div>
  <div id="questions"></div>
</div>

<script>
let waktu = 3600;
let timerInterval;

/* ===== CBT PROTECTION ===== */
window.onbeforeunload = () => "Ujian sedang berlangsung.";

function setExamStarted() {
  localStorage.setItem("examStarted","yes");
}

function clearExamStatus() {
  localStorage.removeItem("examStarted");
}

/* ===== START ===== */
function start() {
  const nama = document.getElementById("nama").value.trim();
  if (!nama) return alert("Masukkan nama!");

  setExamStarted();

  document.getElementById("login").style.display = "none";
  document.getElementById("quiz").classList.remove("hidden");

  renderQuestions();
  startTimer();
}

/* ===== TIMER ===== */
function startTimer() {
  timerInterval = setInterval(() => {
    let m = Math.floor(waktu/60);
    let s = waktu%60;
    timer.innerText = `Sisa waktu: ${m}:${s<10?"0":""}${s}`;
    waktu--;
    if (waktu < 0) selesai();
  },1000);
}

/* ===== SOAL ===== */
const questions = [
  { q:"She ____ to school every day.", options:["go","goes","went","going","gone"], answer:1 }
];

function renderQuestions() {
  let html = "";
  questions.forEach((q,i)=>{
    html += `<p>${i+1}. ${q.q}</p>`;
    q.options.forEach((o,j)=>{
      html += `<label><input type="radio" name="q${i}" value="${j}"> ${o}</label><br>`;
    });
  });
  html += `<br><button onclick="selesai()">SELESAI</button>`;
  questionsDiv.innerHTML = html;
}

/* ===== SELESAI ===== */
function selesai() {
  clearInterval(timerInterval);
  clearExamStatus();

  let score = 0;
  questions.forEach((q,i)=>{
    const c = document.querySelector(`input[name="q${i}"]:checked`);
    if (c && +c.value === q.answer) score++;
  });

  const fd = new FormData();
  fd.append("nama", nama.value);
  fd.append("skor", score);
  fd.append("total", questions.length);

  fetch("https://script.google.com/macros/s/AKfycbxEFXvRa3q4qfPyU_q5LnHXtYlH7w3slGKMukQ8DV9RtRxiPY8gIkIJrVtrRdOUQm36TQ/exec", { method:"POST", body:fd })
    .then(()=>alert("Ujian selesai\nNilai: "+score))
    .then(()=>location.reload())
    .catch(()=>alert("Gagal mengirim nilai"));
}

/* ===== RESUME ===== */
if (localStorage.getItem("examStarted")==="yes") start();
</script>

</body>
</html>
